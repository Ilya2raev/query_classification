## **Query Classification for Retrieval Augmented Generation**

```
Not all queries require to be retrieval-augmented due to the inherent capabilities of LLMs. While RAG can enhance information accuracy and reduce hallucinations, frequent retrieval costs longerresponse time.
```
## üìÑ [–ò—Å—Ç–æ—á–Ω–∏–∫]((https://aclanthology.org/2024.emnlp-main.981.pdf))


## üõ† 1. –î–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º—ã:
![](docs/query_classification_design.png)

üìå **–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π MVP:**  
‚úÖ **Qdrant** ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **Transformers** ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏  
‚úÖ **BitsAndBytes** ‚Äî –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è LLM  
‚úÖ **SentenceTransformer** ‚Äî —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —á–∞–Ω–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞

## 2. –ú–µ—Ç—Ä–∏–∫–∏

–û—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —è–≤–ª—è—é—Ç—Å—è RAG Score, token-level F1 –∏ —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –ø–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è MVP, –æ–Ω–∏ –∑–¥–µ—Å—å –Ω–µ —Ç—Ä–µ–∫–∞–ª–∏—Å—å

## 3. –†–µ—à–µ–Ω–∏–µ 

–í —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤:

### üîπ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤. –ò—â–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–µ–Ω –ª–∏ RAG.

**–ü–ª—é—Å—ã**:

- –ù–µ —Ç—Ä–µ–±—É–µ—Ç ML –∏ –∏–º–µ–µ—Ç –±—ã—Å—Ç—Ä—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å

**–ú–∏–Ω—É—Å—ã**:

- –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—É–º–∞, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ö–≤–∞—Ç–∏—Ç—å –≤—Å–µ —Å–ª—É—á–∞–∏, –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å —è–∑—ã–∫–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏


### üîπ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ ML (TF-IDF+–±—É—Å—Ç–∏–Ω–≥)

**–ü–ª—é—Å—ã**:

- –ë—ã—Å—Ç—Ä–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

**–ú–∏–Ω—É—Å—ã**:

- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—á–µ—Ç–∞ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ —Ç–µ–∫—Å—Ç–∞

### üîπ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞

**–ü–ª—é—Å—ã**:

- –ù–∞–ª–∏—á–∏–µ –∏–Ω–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è –∏ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—á–µ—Å—Ç—å –±–æ–ª—å—à–µ —Å–ª—É—á–∞–µ–≤, –Ω–µ –ø–æ–ø–∞–≤—à–∏—Ö –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ú–∏–Ω—É—Å—ã**:

- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å

–î–ª—è MVP –±—ã–ª –≤—ã–±—Ä–∞–Ω –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–∏–≤–Ω—ã–π DistilBERT —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤. –î–∞—Ç–∞—Å–µ—Ç - [Dolly15k](https://huggingface.co/datasets/databricks/databricks-dolly-15k) (—Ä–∞–∑–¥–µ–ª "instruction"). –î–ª—è –Ω–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –Ω–µ–±–æ–ª—å—à–æ–π –±–ª–æ–∫–Ω–æ—Ç —Å EDA –∏ Topic Modeling.

üìå **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç** -  –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **LLM –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö**, —Ç–∞–∫ –∫–∞–∫ –º–æ–¥–µ–ª—å –∑–Ω–∞–µ—Ç, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –µ–π –ø–æ–Ω—è—Ç–Ω—ã, –∞ –∫–∞–∫–∏–µ - –Ω–µ—Ç.

## –í–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ–∑–º–æ–∂–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π:

- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ LLM, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ MVP –æ–Ω –Ω–æ—Å–∏—Ç —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ —Å –ø–æ–º–æ—â—å—é PagedAttention –∏ vllm
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä –≤ Qdrant
- –†–∞–∑–º–µ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º LLM
- –¢—Ä–µ–∫–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ë–æ–ª–µ–µ —Ç—â–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –∏ –¥–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Ç–æ–∂–µ —Å–∞–º–æ–µ –∫–∞—Å–∞–µ—Ç—Å—è LLM
- –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–≤ MVP –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏—Å—å)
